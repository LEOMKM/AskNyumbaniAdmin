(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{889:function(e,r,s){Promise.resolve().then(s.bind(s,7435))},7435:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return v}});var t=s(7437),n=s(2265),a=s(9376),i=s(3844),l=s(2869),c=s(535),o=s(4508);let d=(0,c.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),u=n.forwardRef((e,r)=>{let{className:s,variant:n,...a}=e;return(0,t.jsx)("div",{ref:r,role:"alert",className:(0,o.cn)(d({variant:n}),s),...a})});u.displayName="Alert",n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("h5",{ref:r,className:(0,o.cn)("mb-1 font-medium leading-none tracking-tight",s),...n})}).displayName="AlertTitle";let m=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("text-sm [&_p]:leading-relaxed",s),...n})});m.displayName="AlertDescription";var f=s(8906);let g=(0,s(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function x(e){let{onSuccess:r,onBack:s}=e,{loginWithPin:a,isLoading:c}=(0,i.a)(),[o,d]=(0,n.useState)(""),[x,p]=(0,n.useState)(""),[v,h]=(0,n.useState)(!1),y=(0,n.useRef)([]);(0,n.useEffect)(()=>{y.current[0]&&y.current[0].focus()},[]);let N=(e,r)=>{if(!/^\d*$/.test(r))return;let s=o.split("");s[e]=r;let t=s.join("").slice(0,4);if(d(t),r&&e<3){var n;null===(n=y.current[e+1])||void 0===n||n.focus()}4===t.length&&_(t),x&&p("")},b=(e,r)=>{if("Backspace"===r.key&&!o[e]&&e>0){var s;null===(s=y.current[e-1])||void 0===s||s.focus()}},_=async e=>{var s,t;let n=e||o;if(4===n.length){p(""),h(!0);try{let e=await a(n);e.success?r():(p(e.message),d(""),null===(s=y.current[0])||void 0===s||s.focus())}catch(e){p("An unexpected error occurred"),d(""),null===(t=y.current[0])||void 0===t||t.focus()}finally{h(!1)}}},j=e=>{e.preventDefault();let r=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,4);4===r.length&&(d(r),_(r))};return(0,t.jsxs)("div",{className:"space-y-6",children:[x&&(0,t.jsx)(u,{variant:"destructive",children:(0,t.jsx)(m,{children:x})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"flex justify-center space-x-3",children:[0,1,2,3].map(e=>(0,t.jsx)("input",{ref:r=>{y.current[e]=r},type:"text",inputMode:"numeric",maxLength:1,value:o[e]||"",onChange:r=>N(e,r.target.value),onKeyDown:r=>b(e,r),onPaste:j,className:"w-12 h-12 text-center text-2xl font-bold border-2 border-input rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none disabled:opacity-50",disabled:v},e))}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter your 4-digit PIN"})})]}),(0,t.jsx)(l.z,{onClick:()=>_(),className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:4!==o.length||v||c,children:v?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-foreground"}),(0,t.jsx)("span",{children:"Verifying PIN..."})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Verify PIN"})]})}),s&&(0,t.jsxs)(l.z,{type:"button",variant:"outline",onClick:s,className:"w-full",disabled:v,children:[(0,t.jsx)(g,{className:"h-4 w-4 mr-2"}),"Back to Login"]})]})}var p=s(6070);function v(){let{user:e,isLoading:r}=(0,i.a)(),s=(0,a.useRouter)();return((0,n.useEffect)(()=>{!r&&e&&s.push("/")},[e,r,s]),r)?(0,t.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Loading..."})]})}):e?null:(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("div",{className:"bg-primary text-primary-foreground shadow-lg",children:(0,t.jsx)("div",{className:"container mx-auto px-6 py-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary-foreground/20 rounded-lg",children:(0,t.jsx)(f.Z,{className:"h-8 w-8 text-primary-foreground"})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-primary-foreground",children:"AskNyumbani Admin"}),(0,t.jsx)("p",{className:"text-primary-foreground/80",children:"Image Review & Approval System"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-6 py-12",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,t.jsxs)(p.Zb,{className:"shadow-xl",children:[(0,t.jsxs)(p.Ol,{className:"text-center pb-6",children:[(0,t.jsx)("div",{className:"mx-auto mb-4 p-3 bg-primary/10 rounded-full w-fit",children:(0,t.jsx)(f.Z,{className:"h-8 w-8 text-primary"})}),(0,t.jsx)(p.ll,{className:"text-2xl",children:"Admin Login"}),(0,t.jsx)(p.SZ,{children:"Enter your 4-digit PIN to access the admin panel"})]}),(0,t.jsx)(p.aY,{className:"space-y-6",children:(0,t.jsx)(x,{onSuccess:()=>s.push("/")})})]}),(0,t.jsxs)("div",{className:"text-center mt-8 text-sm text-muted-foreground",children:[(0,t.jsx)("p",{children:"\xa9 2025 Codzure Group. All rights reserved."}),(0,t.jsx)("p",{className:"mt-1",children:"AskNyumbani Real Estate Platform"})]})]})})]})}},2869:function(e,r,s){"use strict";s.d(r,{z:function(){return o}});var t=s(7437),n=s(2265),a=s(7053),i=s(535),l=s(4508);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,r)=>{let{className:s,variant:n,size:i,asChild:o=!1,...d}=e,u=o?a.g7:"button";return(0,t.jsx)(u,{className:(0,l.cn)(c({variant:n,size:i,className:s})),ref:r,...d})});o.displayName="Button"},6070:function(e,r,s){"use strict";s.d(r,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return d},ll:function(){return c}});var t=s(7437),n=s(2265),a=s(4508);let i=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...n})});l.displayName="CardHeader";let c=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("h3",{ref:r,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});c.displayName="CardTitle";let o=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",s),...n})});o.displayName="CardDescription";let d=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",s),...n})});d.displayName="CardContent",n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},3844:function(e,r,s){"use strict";s.d(r,{AuthProvider:function(){return l},a:function(){return c}});var t=s(7437),n=s(2265),a=s(970);let i=(0,n.createContext)(void 0);function l(e){let{children:r}=e,[s,l]=(0,n.useState)(null),[c,o]=(0,n.useState)(null),[d,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("admin_session_token");e?m(e):u(!1)},[]);let m=async e=>{try{let{data:r,error:s}=await a.O.rpc("validate_admin_session",{p_session_token:e});if(s||!r||0===r.length){localStorage.removeItem("admin_session_token"),o(null),l(null),u(!1);return}let t=r[0];l({id:t.admin_user_id,email:t.email,full_name:t.full_name,role:t.role,is_active:t.is_active,is_first_login:!1}),o(e)}catch(e){console.error("Session validation error:",e),localStorage.removeItem("admin_session_token"),o(null),l(null)}finally{u(!1)}},f=async(e,r)=>{try{u(!0);let{data:s,error:t}=await a.O.rpc("admin_login",{p_email:e,p_password:r});if(t)return{success:!1,message:t.message};if(!s||0===s.length)return{success:!1,message:"Invalid email or password"};let n=s[0],i=n.session_token;return localStorage.setItem("admin_session_token",i),o(i),l({id:n.admin_user_id,email:n.email,full_name:n.full_name,role:n.role,is_active:n.is_active,is_first_login:n.is_first_login}),{success:!0,message:"Login successful"}}catch(e){return console.error("Login error:",e),{success:!1,message:"An error occurred during login"}}finally{u(!1)}},g=async e=>{try{u(!0);let{data:r,error:s}=await a.O.rpc("admin_login_with_pin",{p_pin:e});if(s)return{success:!1,message:s.message};if(!r||0===r.length)return{success:!1,message:"Invalid PIN"};let t=r[0],n=t.session_token;return localStorage.setItem("admin_session_token",n),o(n),l({id:t.admin_user_id,email:t.email,full_name:t.full_name,role:t.role,is_active:t.is_active,is_first_login:!1}),{success:!0,message:"Login successful"}}catch(e){return console.error("PIN login error:",e),{success:!1,message:"An error occurred during PIN login"}}finally{u(!1)}},x=async e=>{try{if(!s)return{success:!1,message:"No user logged in"};let{error:r}=await a.O.rpc("create_admin_pin",{p_admin_user_id:s.id,p_pin:e});if(r)return{success:!1,message:r.message};return{success:!0,message:"PIN created successfully"}}catch(e){return console.error("Create PIN error:",e),{success:!1,message:"An error occurred creating PIN"}}},p=async()=>{try{c&&await a.O.rpc("invalidate_admin_session",{p_session_token:c})}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("admin_session_token"),o(null),l(null)}},v=async()=>{c&&await m(c)};return(0,t.jsx)(i.Provider,{value:{user:s,sessionToken:c,isLoading:d,login:f,loginWithPin:g,createPin:x,logout:p,refreshSession:v},children:r})}function c(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},970:function(e,r,s){"use strict";s.d(r,{O:function(){return t}});let t=(0,s(1545).eI)("https://yqilhwaexdehmrcdblgz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxaWxod2FleGRlaG1yY2RibGd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwODk3MDAsImV4cCI6MjA3NTY2NTcwMH0.aZhWBpB1EfckSU82hEi_c5tKptjcCMChDETCPjAVESs")},4508:function(e,r,s){"use strict";s.d(r,{cn:function(){return a}});var t=s(1994),n=s(3335);function a(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,n.m6)((0,t.W)(r))}}},function(e){e.O(0,[545,320,971,117,744],function(){return e(e.s=889)}),_N_E=e.O()}]);