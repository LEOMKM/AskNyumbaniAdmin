(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1102:function(e,r,s){Promise.resolve().then(s.bind(s,3259))},3259:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return ex}});var a=s(7437),t=s(2265),i=s(9376),n=s(3844),l=s(6070),o=s(2869),d=s(3145),c=s(535),m=s(4508);let x=(0,c.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u(e){let{className:r,variant:s,...t}=e;return(0,a.jsx)("div",{className:(0,m.cn)(x({variant:s}),r),...t})}var p=s(1027),g=s(401);let f=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)(p.fC,{ref:r,className:(0,m.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:(0,a.jsx)(p.z$,{className:(0,m.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})})})});f.displayName=p.fC.displayName;let h=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("textarea",{className:(0,m.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...t})});h.displayName="Textarea";var v=s(1713),y=s(9827),j=s(1770),N=s(970);async function w(e){let{adminUserId:r,activityType:s,description:a,metadata:t}=e;try{let{error:e}=await N.O.from("admin_activity_log").insert([{admin_user_id:r,activity_type:s,description:a,metadata:null!=t?t:null}]);if(e)throw e}catch(e){console.error("Failed to log admin activity:",e)}}function b(){let e=(0,y.NL)(),{user:r}=(0,n.a)();return(0,j.D)({mutationFn:async e=>{let{imageId:s,propertyId:a,propertyTitle:t,imageUrl:i}=e;if(!r)throw Error("User not authenticated");let{error:n}=await N.O.rpc("approve_property_image",{p_image_id:s,p_admin_user_id:r.id});if(n)throw n;await w({adminUserId:r.id,activityType:"image_approved",description:"Approved property image".concat(t?' for "'.concat(t,'"'):""),metadata:{imageId:s,propertyId:null!=a?a:null,propertyTitle:null!=t?t:null,imageUrl:null!=i?i:null,action:"approve"}})},onSuccess:()=>{e.invalidateQueries({queryKey:["pending-image-reviews"]}),e.invalidateQueries({queryKey:["image-review-history"]}),e.invalidateQueries({queryKey:["image-review-stats"]}),e.invalidateQueries({queryKey:["admin-activity-log"]})}})}function _(){let e=(0,y.NL)(),{user:r}=(0,n.a)();return(0,j.D)({mutationFn:async e=>{let{imageId:s,imageUrl:a,rejectionReason:t,propertyId:i,propertyTitle:n}=e;if(!r)throw Error("User not authenticated");if(!t||""===t.trim())throw Error("Rejection reason is required");if(a)try{let e=a.split("/storage/v1/object/public/");if(2===e.length){let[r,...s]=e[1].split("/"),a=s.join("/"),{error:t}=await N.O.storage.from(r).remove([a]);t&&console.error("Failed to delete image from storage:",t)}}catch(e){console.error("Error parsing image URL for deletion:",e)}let{error:l}=await N.O.rpc("reject_property_image",{p_image_id:s,p_admin_user_id:r.id,p_rejection_reason:t.trim()});if(l)throw l;await w({adminUserId:r.id,activityType:"image_rejected",description:"Rejected property image".concat(n?' for "'.concat(n,'"'):""),metadata:{imageId:s,propertyId:null!=i?i:null,propertyTitle:null!=n?n:null,imageUrl:null!=a?a:null,rejectionReason:t.trim(),action:"reject"}})},onSuccess:()=>{e.invalidateQueries({queryKey:["pending-image-reviews"]}),e.invalidateQueries({queryKey:["image-review-history"]}),e.invalidateQueries({queryKey:["image-review-stats"]}),e.invalidateQueries({queryKey:["admin-activity-log"]})}})}var Z=s(5302),k=s(5131),I=s(1723),C=s(2489),R=s(3639),z=s(3774),A=s(2369),P=s(1047),O=s(7868);function S(e){let{image:r,isOpen:s,onClose:i}=e,[n,c]=(0,t.useState)(""),[m,x]=(0,t.useState)(!1),p=b(),g=_(),f=async()=>{try{await p.mutateAsync({imageId:r.id,propertyId:r.property_id,propertyTitle:r.property_title,imageUrl:r.image_url}),i()}catch(e){console.error("Failed to approve image:",e),alert("Failed to approve image. Please try again.")}},v=async()=>{if(!n.trim()){alert("Please provide a reason for rejection");return}try{await g.mutateAsync({imageId:r.id,imageUrl:r.image_url,rejectionReason:n.trim(),propertyId:r.property_id,propertyTitle:r.property_title}),i()}catch(e){console.error("Failed to reject image:",e),alert("Failed to reject image. Please try again.")}};return s?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:(0,a.jsxs)(l.Zb,{className:"w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(l.ll,{className:"text-xl",children:"Image Review"}),(0,a.jsx)(l.SZ,{children:"Review property image for approval"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[!0===r.admin_approved?(0,a.jsxs)(u,{variant:"secondary",className:"bg-green-100 text-green-800 border-green-200",children:[(0,a.jsx)(Z.Z,{className:"h-3 w-3 mr-1"}),"Approved"]}):!1===r.admin_approved?(0,a.jsxs)(u,{variant:"secondary",className:"bg-red-100 text-red-800 border-red-200",children:[(0,a.jsx)(k.Z,{className:"h-3 w-3 mr-1"}),"Rejected"]}):(0,a.jsxs)(u,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[(0,a.jsx)(I.Z,{className:"h-3 w-3 mr-1"}),"Pending Review"]}),(0,a.jsx)(o.z,{variant:"ghost",size:"sm",onClick:i,children:(0,a.jsx)(C.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)(l.aY,{className:"space-y-6",children:[(0,a.jsx)("div",{className:"relative aspect-video w-full overflow-hidden rounded-lg bg-muted",children:m?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(R.Z,{className:"h-16 w-16 text-muted-foreground"})}):(0,a.jsx)(d.default,{src:r.image_url,alt:r.caption||"Property image",fill:!0,className:"object-contain",onError:()=>x(!0),sizes:"(max-width: 768px) 100vw, 80vw"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Property Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(z.Z,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:r.property_title||"Property Image"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[r.property_address,", ",r.property_city]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:r.property_owner_name||"Unknown Owner"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:r.property_owner_email}),r.property_owner_phone&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:r.property_owner_phone})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(P.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Uploaded"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,O.Z)(new Date(r.created_at),"MMM d, yyyy 'at' h:mm a")})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Image Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Caption"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:r.caption||"No caption provided"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Display Order"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:r.display_order})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Primary Image"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:r.is_primary?"Yes":"No"})]}),r.admin_rejection_reason&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-red-600",children:"Rejection Reason"}),(0,a.jsx)("p",{className:"text-sm text-red-600",children:r.admin_rejection_reason})]})]})]})]}),null===r.admin_approved&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Review Actions"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"mt-2 flex flex-col sm:flex-row sm:justify-start",children:(0,a.jsxs)(o.z,{onClick:f,disabled:p.isPending||g.isPending,className:"w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 mr-2"}),p.isPending?"Approving...":"Approve Image"]})}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-red-600",children:"Reject with Reason (Required)"}),(0,a.jsx)(h,{placeholder:"Provide a reason for rejecting this image...",value:n,onChange:e=>c(e.target.value),className:"mt-2 border-red-200 focus:border-red-500",rows:3}),(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:gap-3",children:[(0,a.jsxs)(o.z,{variant:"destructive",onClick:v,disabled:g.isPending||p.isPending||!n.trim(),className:"w-full sm:flex-1",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 mr-2"}),g.isPending?"Rejecting...":"Reject & Delete Image"]}),(0,a.jsx)(o.z,{variant:"outline",onClick:i,disabled:g.isPending||p.isPending,className:"w-full sm:w-auto",children:"Cancel"})]})]})]})]}),null!==r.admin_approved&&r.admin_reviewed_at&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Review History"}),(0,a.jsx)("div",{className:"bg-muted p-4 rounded-lg",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Reviewed On"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,O.Z)(new Date(r.admin_reviewed_at),"MMM d, yyyy 'at' h:mm a")})]}),r.reviewer_name&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Reviewed By"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:r.reviewer_name})]})]})})]})]})]})}):null}var q=s(6595),F=s(2208),L=s(3417);function U(e){let{image:r,isSelected:s,onSelect:i,showSelection:n=!1}=e,[c,m]=(0,t.useState)(!1),[x,p]=(0,t.useState)(!1),g=b(),h=_(),v=async e=>{if(e.stopPropagation(),confirm(r.property_title?'Approve image for "'.concat(r.property_title,'"?'):"Approve this image?"))try{await g.mutateAsync({imageId:r.id,propertyId:r.property_id,propertyTitle:r.property_title,imageUrl:r.image_url})}catch(e){console.error("Failed to approve image:",e)}},y=async e=>{e.stopPropagation();let s=prompt("Please provide a reason for rejection:");if(s&&s.trim())try{await h.mutateAsync({imageId:r.id,rejectionReason:s.trim(),imageUrl:r.image_url,propertyId:r.property_id,propertyTitle:r.property_title})}catch(e){console.error("Failed to reject image:",e)}},j=g.isPending||h.isPending;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Zb,{className:"\n        relative transition-all duration-300 hover:shadow-xl hover:scale-[1.02]\n        ".concat(s?"ring-2 ring-primary ring-offset-2 shadow-lg":"shadow-md","\n        ").concat(j?"opacity-50 pointer-events-none":"","\n        group overflow-hidden\n      "),children:[n&&(0,a.jsx)("div",{className:"absolute top-3 left-3 z-10",children:(0,a.jsx)(f,{checked:s,onCheckedChange:i,className:"bg-white/95 backdrop-blur-sm shadow-md"})}),(0,a.jsx)("div",{className:"absolute top-3 right-3 z-10",children:!0===r.admin_approved?(0,a.jsxs)(u,{variant:"secondary",className:"bg-green-100 text-green-800 border-green-200 shadow-sm",children:[(0,a.jsx)(Z.Z,{className:"h-3 w-3 mr-1"}),"Approved"]}):!1===r.admin_approved?(0,a.jsxs)(u,{variant:"secondary",className:"bg-red-100 text-red-800 border-red-200 shadow-sm",children:[(0,a.jsx)(k.Z,{className:"h-3 w-3 mr-1"}),"Rejected"]}):(0,a.jsxs)(u,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 border-yellow-200 shadow-sm",children:[(0,a.jsx)(I.Z,{className:"h-3 w-3 mr-1"}),"Pending"]})}),r.is_primary&&(0,a.jsx)("div",{className:"absolute top-3 left-1/2 transform -translate-x-1/2 z-10",children:(0,a.jsxs)(u,{variant:"secondary",className:"bg-primary/90 text-primary-foreground shadow-md",children:[(0,a.jsx)(q.Z,{className:"h-3 w-3 mr-1"}),"Primary"]})}),(0,a.jsxs)("div",{className:"relative aspect-square overflow-hidden",children:[x?(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-muted",children:(0,a.jsx)(R.Z,{className:"h-12 w-12 text-muted-foreground"})}):(0,a.jsx)(d.default,{src:r.image_url,alt:r.caption||"Property image",fill:!0,className:"object-cover transition-transform duration-300 group-hover:scale-105",onError:()=>p(!0),sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300 flex items-center justify-center",children:(0,a.jsxs)(o.z,{variant:"secondary",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 shadow-lg",onClick:()=>m(!0),children:[(0,a.jsx)(F.Z,{className:"h-4 w-4 mr-2"}),"Review"]})})]}),(0,a.jsxs)(l.aY,{className:"p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm text-foreground line-clamp-1",children:r.property_title||"Property Image"}),(0,a.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground",children:[(0,a.jsx)(z.Z,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,a.jsxs)("span",{className:"line-clamp-1",children:[r.property_address,", ",r.property_city]})]})]}),(0,a.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground",children:[(0,a.jsx)(A.Z,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,a.jsx)("span",{className:"line-clamp-1",children:r.property_owner_name||"Unknown Owner"})]}),(0,a.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground",children:[(0,a.jsx)(P.Z,{className:"h-3 w-3 mr-1 flex-shrink-0"}),(0,a.jsx)("span",{children:(0,O.Z)(new Date(r.created_at),"MMM d, yyyy")})]}),r.caption&&(0,a.jsx)("div",{className:"pt-2 border-t border-border",children:(0,a.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:r.caption})}),r.admin_comment&&(0,a.jsx)("div",{className:"pt-2 border-t border-border",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(L.Z,{className:"h-3 w-3 text-primary mt-0.5 flex-shrink-0"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Admin:"})," ",r.admin_comment]})]})}),null===r.admin_approved&&(0,a.jsxs)("div",{className:"mt-3 border-t border-border pt-3 flex flex-col gap-2 sm:flex-row sm:gap-3",children:[(0,a.jsxs)(o.z,{size:"sm",onClick:v,disabled:j,className:"w-full sm:flex-1 bg-green-600 hover:bg-green-700 text-white shadow-sm",children:[(0,a.jsx)(Z.Z,{className:"h-3 w-3 mr-1"}),"Approve"]}),(0,a.jsxs)(o.z,{size:"sm",variant:"destructive",onClick:y,disabled:j,className:"w-full sm:flex-1 shadow-sm",children:[(0,a.jsx)(k.Z,{className:"h-3 w-3 mr-1"}),"Reject"]})]}),null!==r.admin_approved&&r.admin_reviewed_at&&(0,a.jsx)("div",{className:"pt-3 border-t border-border",children:(0,a.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Reviewed:"}),(0,a.jsx)("span",{children:(0,O.Z)(new Date(r.admin_reviewed_at),"MMM d, yyyy")})]}),r.reviewer_name&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"By:"}),(0,a.jsx)("span",{className:"line-clamp-1",children:r.reviewer_name})]})]})}),!1===r.admin_approved&&r.admin_rejection_reason&&(0,a.jsx)("div",{className:"pt-2 border-t border-border",children:(0,a.jsxs)("p",{className:"text-xs text-red-600 line-clamp-2",children:[(0,a.jsx)("strong",{children:"Reason:"})," ",r.admin_rejection_reason]})})]})]}),(0,a.jsx)(S,{image:r,isOpen:c,onClose:()=>m(!1)})]})}function Y(e){let{selectedCount:r,onClear:s}=e,[i,d]=(0,t.useState)(!1),c=function(){let e=(0,y.NL)(),{user:r}=(0,n.a)();return(0,j.D)({mutationFn:async e=>{let{error:s}=await N.O.from("property_images").update({admin_approved:!0,admin_rejection_reason:null}).in("id",e);if(s)throw s;r&&e.length>0&&await w({adminUserId:r.id,activityType:"bulk_image_approved",description:"Bulk approved ".concat(e.length," image").concat(1===e.length?"":"s"),metadata:{imageIds:e,action:"bulk_approve"}})},onSuccess:()=>{e.invalidateQueries({queryKey:["pending-image-reviews"]}),e.invalidateQueries({queryKey:["image-review-history"]}),e.invalidateQueries({queryKey:["admin-activity-log"]})}})}(),m=async()=>{d(!0)};return i?(0,a.jsxs)(l.Zb,{className:"border-primary",children:[(0,a.jsxs)(l.Ol,{className:"pb-3",children:[(0,a.jsxs)(l.ll,{className:"text-lg flex items-center",children:[(0,a.jsx)(R.Z,{className:"h-5 w-5 text-yellow-500 mr-2"}),"Confirm Bulk Approval"]}),(0,a.jsxs)(l.SZ,{children:["Are you sure you want to approve ",r," images? This action cannot be undone."]})]}),(0,a.jsx)(l.aY,{className:"space-y-3",children:(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)(o.z,{onClick:()=>{d(!1),s()},className:"bg-green-600 hover:bg-green-700",disabled:c.isPending,children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 mr-2"}),"Yes, Approve All"]}),(0,a.jsx)(o.z,{variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[r," selected"]}),(0,a.jsxs)(o.z,{size:"sm",onClick:m,className:"bg-green-600 hover:bg-green-700",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 mr-1"}),"Approve All"]}),(0,a.jsxs)(o.z,{size:"sm",variant:"outline",onClick:s,children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-1"}),"Clear"]})]})}var E=s(2252);function T(e){let{filter:r}=e,[s,i]=(0,t.useState)([]),{data:n,isLoading:d,error:c}=(0,v.a)({queryKey:["pending-image-reviews"],queryFn:async()=>{let{data:e,error:r}=await N.O.from("pending_image_reviews").select("*").order("created_at",{ascending:!0});if(r)throw r;return e},refetchInterval:3e4}),{data:m,isLoading:x,error:u}=(0,v.a)({queryKey:["image-review-history"],queryFn:async()=>{let{data:e,error:r}=await N.O.from("image_review_history").select("*").order("admin_reviewed_at",{ascending:!1});if(r)throw r;return e}}),p="pending"===r?n||[]:"approved"===r?(m||[]).filter(e=>!0===e.admin_approved):[...n||[],...(m||[]).filter(e=>!0===e.admin_approved)],g=(e,r)=>{r?i(r=>[...r,e]):i(r=>r.filter(r=>r!==e))};if(c||u)return(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.aY,{className:"p-8 text-center",children:[(0,a.jsx)(E.Z,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Error Loading Images"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"There was an error loading the image data. Please try again."}),(0,a.jsx)(o.z,{onClick:()=>window.location.reload(),children:"Retry"})]})});if(d||x)return(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)(I.Z,{className:"h-6 w-6 animate-spin text-primary"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Loading images..."})]})})});if(0===p.length){let e=(()=>{switch(r){case"pending":return{icon:Z.Z,title:"No Pending Reviews",description:"All images have been reviewed. Great job!",color:"text-green-600"};case"approved":return{icon:Z.Z,title:"No Approved Images",description:"No images have been approved yet.",color:"text-muted-foreground"};default:return{icon:I.Z,title:"No Images Found",description:"No property images available for review.",color:"text-muted-foreground"}}})(),s=e.icon;return(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.aY,{className:"p-8 text-center",children:[(0,a.jsx)(s,{className:"h-12 w-12 ".concat(e.color," mx-auto mb-4")}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:e.title}),(0,a.jsx)("p",{className:"text-muted-foreground",children:e.description})]})})}return(0,a.jsxs)("div",{className:"space-y-6",children:["pending"===r&&p.length>0&&(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(l.ll,{className:"text-lg",children:["Pending Image Reviews (",p.length,")"]}),(0,a.jsx)(l.SZ,{children:"Review and approve property images before they appear in the app"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:()=>{s.length===p.length?i([]):i(p.map(e=>e.id))},className:"text-sm",children:s.length===p.length?"Deselect All":"Select All"}),s.length>0&&(0,a.jsx)(Y,{selectedCount:s.length,onClear:()=>{i([])}})]})]})})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:p.map(e=>(0,a.jsx)(U,{image:e,isSelected:s.includes(e.id),onSelect:r=>g(e.id,r),showSelection:"pending"===r},e.id))}),p.length>=20&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(o.z,{variant:"outline",size:"lg",children:"Load More Images"})})]})}var D=s(1473);function M(e){let{currentFilter:r,onFilterChange:s}=e,t=[{key:"pending",label:"Pending Review",icon:I.Z,color:"text-yellow-600",bgColor:"bg-yellow-50 hover:bg-yellow-100",activeBgColor:"bg-yellow-100"},{key:"approved",label:"Approved",icon:Z.Z,color:"text-green-600",bgColor:"bg-green-50 hover:bg-green-100",activeBgColor:"bg-green-100"},{key:"all",label:"All Images",icon:D.Z,color:"text-primary",bgColor:"bg-primary/10 hover:bg-primary/20",activeBgColor:"bg-primary/20"}];return(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-6",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:t.map(e=>{let t=e.icon,i=r===e.key;return(0,a.jsxs)(o.z,{variant:"ghost",onClick:()=>s(e.key),className:"\n                  ".concat(i?e.activeBgColor:e.bgColor,"\n                  ").concat(e.color,"\n                  border-0\n                  transition-colors\n                  duration-200\n                  font-medium\n                "),children:[(0,a.jsx)(t,{className:"h-4 w-4 mr-2"}),e.label]},e.key)})})})})}var K=s(4081),B=s(3113),Q=s(4401),J=s(5863);let V={image_approved:(0,a.jsx)(Z.Z,{className:"h-4 w-4 text-green-600"}),image_rejected:(0,a.jsx)(k.Z,{className:"h-4 w-4 text-red-600"}),bulk_image_approved:(0,a.jsx)(B.Z,{className:"h-4 w-4 text-primary"})};function G(e){var r;let{type:s}=e;return null!==(r=V[s])&&void 0!==r?r:(0,a.jsx)(Q.Z,{className:"h-4 w-4 text-muted-foreground"})}function H(){let{data:e,isLoading:r,error:s}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return(0,v.a)({queryKey:["admin-activity-log",e],queryFn:async()=>{let{data:r,error:s}=await N.O.from("admin_activity_log").select("*").order("created_at",{ascending:!1}).limit(e);if(s)throw s;return r},refetchInterval:6e4})}(8);return(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{className:"text-lg",children:"Recent Activity"})}),(0,a.jsx)(l.aY,{children:r?(0,a.jsxs)("div",{className:"flex items-center justify-center py-10 text-muted-foreground",children:[(0,a.jsx)(J.Z,{className:"h-5 w-5 animate-spin mr-2"}),"Loading activity..."]}):s?(0,a.jsx)("div",{className:"py-6 text-sm text-red-600",children:"Unable to load activity log. Please try again later."}):e&&0!==e.length?(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>{var r,s;let t=null!==(r=e.metadata)&&void 0!==r?r:{},i=t.propertyTitle||"",n=t.propertyId||"",l=t.rejectionReason;return(0,a.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-border/60 bg-muted/30 p-3",children:[(0,a.jsx)("div",{className:"mt-0.5 rounded-full bg-background p-2 shadow-sm",children:(0,a.jsx)(G,{type:e.activity_type})}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-foreground",children:null!==(s=e.description)&&void 0!==s?s:e.activity_type.replace(/_/g," ")}),(i||n)&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:i||"Property ID: ".concat(n)}),l&&(0,a.jsxs)("p",{className:"text-xs text-red-600",children:["Reason: ",l]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,K.Z)(new Date(e.created_at),{addSuffix:!0})})]})]},e.id)})}):(0,a.jsx)("div",{className:"py-6 text-sm text-muted-foreground",children:"No recent admin activity recorded yet."})})]})}function W(){let[e,r]=(0,t.useState)("pending"),{data:s,isLoading:i}=(0,v.a)({queryKey:["image-review-stats"],queryFn:async()=>{let[e,r,s]=await Promise.all([N.O.from("property_images").select("id",{count:"exact"}).is("admin_approved",null),N.O.from("property_images").select("id",{count:"exact"}).eq("admin_approved",!0),N.O.from("property_images").select("id",{count:"exact"}).eq("admin_approved",!1)]);if(e.error)throw e.error;if(r.error)throw r.error;if(s.error)throw s.error;return{pending:e.count||0,approved:r.count||0,rejected:s.count||0,total:(e.count||0)+(r.count||0)+(s.count||0)}},refetchInterval:6e4});return(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsxs)("div",{className:"container mx-auto px-6 py-8 space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)(l.Zb,{className:"border-l-4 border-l-yellow-500",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Pending Review"}),(0,a.jsx)(I.Z,{className:"h-4 w-4 text-yellow-500"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:i?"...":(null==s?void 0:s.pending)||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Images awaiting approval"})]})]}),(0,a.jsxs)(l.Zb,{className:"border-l-4 border-l-green-500",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),(0,a.jsx)(Z.Z,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:i?"...":(null==s?void 0:s.approved)||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Live in mobile app"})]})]}),(0,a.jsxs)(l.Zb,{className:"border-l-4 border-l-primary",children:[(0,a.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ll,{className:"text-sm font-medium text-muted-foreground",children:"Total Images"}),(0,a.jsx)(B.Z,{className:"h-4 w-4 text-primary"})]}),(0,a.jsxs)(l.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary",children:i?"...":(null==s?void 0:s.total)||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"All property images"})]})]})]}),(0,a.jsx)(M,{currentFilter:e,onFilterChange:r}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 xl:grid-cols-[3fr,1fr]",children:[(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)(T,{filter:e})}),(0,a.jsx)("div",{className:"xl:sticky xl:top-6 xl:self-start",children:(0,a.jsx)(H,{})})]})]})})}var X=s(1196),$=s(407),ee=s(519);let er=X.fC,es=X.xz;X.ZA,X.Uv,X.Tr,X.Ee,t.forwardRef((e,r)=>{let{className:s,inset:t,children:i,...n}=e;return(0,a.jsxs)(X.fF,{ref:r,className:(0,m.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...n,children:[i,(0,a.jsx)($.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=X.fF.displayName,t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)(X.tu,{ref:r,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}).displayName=X.tu.displayName;let ea=t.forwardRef((e,r)=>{let{className:s,sideOffset:t=4,...i}=e;return(0,a.jsx)(X.Uv,{children:(0,a.jsx)(X.VY,{ref:r,sideOffset:t,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});ea.displayName=X.VY.displayName;let et=t.forwardRef((e,r)=>{let{className:s,inset:t,...i}=e;return(0,a.jsx)(X.ck,{ref:r,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...i})});et.displayName=X.ck.displayName,t.forwardRef((e,r)=>{let{className:s,children:t,checked:i,...n}=e;return(0,a.jsxs)(X.oC,{ref:r,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:i,...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(X.wU,{children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})})}),t]})}).displayName=X.oC.displayName,t.forwardRef((e,r)=>{let{className:s,children:t,...i}=e;return(0,a.jsxs)(X.Rk,{ref:r,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(X.wU,{children:(0,a.jsx)(ee.Z,{className:"h-2 w-2 fill-current"})})}),t]})}).displayName=X.Rk.displayName,t.forwardRef((e,r)=>{let{className:s,inset:t,...i}=e;return(0,a.jsx)(X.__,{ref:r,className:(0,m.cn)("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...i})}).displayName=X.__.displayName;let ei=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)(X.Z0,{ref:r,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",s),...t})});ei.displayName=X.Z0.displayName;var en=s(8906),el=s(4766),eo=s(3566),ed=s(8728),ec=s(7692);function em(){let{user:e,logout:r}=(0,n.a)(),[s,i]=(0,t.useState)(!1),l=async()=>{i(!0);try{await r()}catch(e){console.error("Logout error:",e)}finally{i(!1)}};return(0,a.jsx)("div",{className:"bg-primary text-primary-foreground shadow-lg",children:(0,a.jsx)("div",{className:"container mx-auto px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"p-2 bg-primary-foreground/20 rounded-lg",children:(0,a.jsx)(en.Z,{className:"h-8 w-8 text-primary-foreground"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-primary-foreground",children:"AskNyumbani Admin"}),(0,a.jsx)("p",{className:"text-primary-foreground/80 text-sm",children:"Image Review & Approval System"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(o.z,{variant:"ghost",size:"sm",className:"text-primary-foreground hover:bg-primary-foreground/20",children:(0,a.jsx)(el.Z,{className:"h-5 w-5"})}),(0,a.jsx)(o.z,{variant:"ghost",size:"sm",className:"text-primary-foreground hover:bg-primary-foreground/20",children:(0,a.jsx)(Q.Z,{className:"h-5 w-5"})}),(0,a.jsxs)(er,{children:[(0,a.jsx)(es,{asChild:!0,children:(0,a.jsx)(o.z,{variant:"ghost",className:"text-primary-foreground hover:bg-primary-foreground/20 p-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-1 bg-primary-foreground/20 rounded-full",children:(0,a.jsx)(A.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-primary-foreground",children:null==e?void 0:e.full_name}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(u,{variant:"secondary",className:"bg-primary-foreground/20 text-primary-foreground text-xs",children:(null==e?void 0:e.role)==="super_admin"?"Super Admin":"Admin"})})]}),(0,a.jsx)(eo.Z,{className:"h-4 w-4"})]})})}),(0,a.jsxs)(ea,{align:"end",className:"w-56",children:[(0,a.jsxs)("div",{className:"px-2 py-1.5",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:null==e?void 0:e.full_name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:null==e?void 0:e.email})]}),(0,a.jsx)(ei,{}),(0,a.jsxs)(et,{children:[(0,a.jsx)(A.Z,{className:"mr-2 h-4 w-4"}),"Profile"]}),(0,a.jsxs)(et,{children:[(0,a.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),"Settings"]}),(0,a.jsxs)(et,{children:[(0,a.jsx)(Q.Z,{className:"mr-2 h-4 w-4"}),"Activity Log"]}),(0,a.jsx)(ei,{}),(0,a.jsxs)(et,{onClick:l,disabled:s,className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(ec.Z,{className:"mr-2 h-4 w-4"}),s?"Logging out...":"Logout"]})]})]})]})]})})})}function ex(){let{user:e,isLoading:r}=(0,n.a)(),s=(0,i.useRouter)();return((0,t.useEffect)(()=>{r||e||s.push("/login")},[e,r,s]),r)?(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Loading..."})]})}):e?(0,a.jsxs)("main",{className:"min-h-screen bg-background",children:[(0,a.jsx)(em,{}),(0,a.jsx)(W,{})]}):null}},2869:function(e,r,s){"use strict";s.d(r,{z:function(){return d}});var a=s(7437),t=s(2265),i=s(7053),n=s(535),l=s(4508);let o=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=t.forwardRef((e,r)=>{let{className:s,variant:t,size:n,asChild:d=!1,...c}=e,m=d?i.g7:"button";return(0,a.jsx)(m,{className:(0,l.cn)(o({variant:t,size:n,className:s})),ref:r,...c})});d.displayName="Button"},6070:function(e,r,s){"use strict";s.d(r,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return n},aY:function(){return c},ll:function(){return o}});var a=s(7437),t=s(2265),i=s(4508);let n=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t})});n.displayName="Card";let l=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",s),...t})});l.displayName="CardHeader";let o=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",s),...t})});o.displayName="CardTitle";let d=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",s),...t})});d.displayName="CardDescription";let c=t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",s),...t})});c.displayName="CardContent",t.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",s),...t})}).displayName="CardFooter"},3844:function(e,r,s){"use strict";s.d(r,{AuthProvider:function(){return l},a:function(){return o}});var a=s(7437),t=s(2265),i=s(970);let n=(0,t.createContext)(void 0);function l(e){let{children:r}=e,[s,l]=(0,t.useState)(null),[o,d]=(0,t.useState)(null),[c,m]=(0,t.useState)(!0);(0,t.useEffect)(()=>{let e=localStorage.getItem("admin_session_token");e?x(e):m(!1)},[]);let x=async e=>{try{let{data:r,error:s}=await i.O.rpc("validate_admin_session",{p_session_token:e});if(s||!r||0===r.length){localStorage.removeItem("admin_session_token"),d(null),l(null),m(!1);return}let a=r[0];l({id:a.admin_user_id,email:a.email,full_name:a.full_name,role:a.role,is_active:a.is_active,is_first_login:!1}),d(e)}catch(e){console.error("Session validation error:",e),localStorage.removeItem("admin_session_token"),d(null),l(null)}finally{m(!1)}},u=async(e,r)=>{try{m(!0);let{data:s,error:a}=await i.O.rpc("admin_login",{p_email:e,p_password:r});if(a)return{success:!1,message:a.message};if(!s||0===s.length)return{success:!1,message:"Invalid email or password"};let t=s[0],n=t.session_token;return localStorage.setItem("admin_session_token",n),d(n),l({id:t.admin_user_id,email:t.email,full_name:t.full_name,role:t.role,is_active:t.is_active,is_first_login:t.is_first_login}),{success:!0,message:"Login successful"}}catch(e){return console.error("Login error:",e),{success:!1,message:"An error occurred during login"}}finally{m(!1)}},p=async e=>{try{m(!0);let{data:r,error:s}=await i.O.rpc("admin_login_with_pin",{p_pin:e});if(s)return{success:!1,message:s.message};if(!r||0===r.length)return{success:!1,message:"Invalid PIN"};let a=r[0],t=a.session_token;return localStorage.setItem("admin_session_token",t),d(t),l({id:a.admin_user_id,email:a.email,full_name:a.full_name,role:a.role,is_active:a.is_active,is_first_login:!1}),{success:!0,message:"Login successful"}}catch(e){return console.error("PIN login error:",e),{success:!1,message:"An error occurred during PIN login"}}finally{m(!1)}},g=async e=>{try{if(!s)return{success:!1,message:"No user logged in"};let{error:r}=await i.O.rpc("create_admin_pin",{p_admin_user_id:s.id,p_pin:e});if(r)return{success:!1,message:r.message};return{success:!0,message:"PIN created successfully"}}catch(e){return console.error("Create PIN error:",e),{success:!1,message:"An error occurred creating PIN"}}},f=async()=>{try{o&&await i.O.rpc("invalidate_admin_session",{p_session_token:o})}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("admin_session_token"),d(null),l(null)}},h=async()=>{o&&await x(o)};return(0,a.jsx)(n.Provider,{value:{user:s,sessionToken:o,isLoading:c,login:u,loginWithPin:p,createPin:g,logout:f,refreshSession:h},children:r})}function o(){let e=(0,t.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},970:function(e,r,s){"use strict";s.d(r,{O:function(){return a}});let a=(0,s(1545).eI)("https://yqilhwaexdehmrcdblgz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxaWxod2FleGRlaG1yY2RibGd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwODk3MDAsImV4cCI6MjA3NTY2NTcwMH0.aZhWBpB1EfckSU82hEi_c5tKptjcCMChDETCPjAVESs")},4508:function(e,r,s){"use strict";s.d(r,{cn:function(){return i}});var a=s(1994),t=s(3335);function i(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,t.m6)((0,a.W)(r))}}},function(e){e.O(0,[545,320,954,171,971,117,744],function(){return e(e.s=1102)}),_N_E=e.O()}]);